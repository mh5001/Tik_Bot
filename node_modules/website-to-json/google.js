var wtj = require('website-to-json')
var wtj = require('./index')
var Promise = require('bluebird');

var Nightmare = require('nightmare');
var nightmare = Nightmare({
  show: true,
}).useragent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36')


var recipes = [{
  pattern: '(.*)',
  parse: function($) {
    return {
      name: $('h1').text(),
      results_count: $('#resultStats').text()
    }
  }
}]

Promise.all(['x-kom.pl', 'oleole.pl'])
.then(function(val) {
  return val
})
.map(function(val) {
  return wtj.extractUrl('https://www.google.com/?gfe_rd=cr&ei=#safe=off&q=' + val, {
    nightmare: nightmare,
    recipes: recipes,
    fields: ['data'],
  })
  .then(function(res) {
    console.log(res);
  })
  .delay(2000)
}, {concurrency: 1})
